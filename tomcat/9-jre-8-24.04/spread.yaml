project: tomcat9

backends:
  craft:
    type: craft
    systems:
      - ubuntu-24.04:

suites:
  spread/general/:
    summary: General integration tests
    environment:
      TOMCAT: 8-jre-8-24.04
    prepare: |
      sudo snap install docker

      # For 'rockcraft.skopeo'
      sudo snap install --classic rockcraft
      sudo apt install -y -u default-jdk maven curl retry
      # Wait for docker daemon to come online

      retry --times=10 --delay 2 -- docker run hello-world

      # Load the rock into docker
      sudo rockcraft.skopeo --insecure-policy copy "oci-archive:$CRAFT_ARTIFACT" docker-daemon:tomcat:${TOMCAT}

    restore: |
      docker image rm --force tomcat:${TOMCAT}


exclude:
  - .git

kill-timeout: 1h
