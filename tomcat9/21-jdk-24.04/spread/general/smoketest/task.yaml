summary: tomcat smoke test

# Tomcat smoke test.
# Create and build webapp project
# Run tomcat9 docker mounting webapp
# Check that webapp runs and index page contains Hello World!

execute: |
  mvn archetype:generate -DgroupId=com.example \
    -DartifactId=hello-world-war \
    -DarchetypeArtifactId=maven-archetype-webapp \
    -DarchetypeVersion=1.4  -DinteractiveMode=false
  cd hello-world-war && mvn package
  docker rm -f tomcat9
  docker run --name tomcat9 -d \
    -v `pwd`/target:/var/lib/tomcat9/webapps -p 8080:8080 tomcat9:21-jdk-24.04 -v
  retry --times=10 --delay 2 -- curl http://localhost:8080/hello-world-war/ | grep -q "Hello World!"
  docker rm -f tomcat9
